<html>

<head>
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@1"></script>
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@4.1.3/dist/css/bootstrap.min.css" integrity="sha384-MCw98/SFnGE8fJT3GXwEOngsV7Zt27NXFoaoApmYm81iuXoPkFOJwJ8ERdknLPMO" crossorigin="anonymous">
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@4.1.3/dist/js/bootstrap.min.js" integrity="sha384-ChfqqxuZUCnJSK3+MXmPNIyE6ZbWh2IMqE241rYiqJxyMiZ6OW/JmZQ5stwEULTy" crossorigin="anonymous"></script>
    <link rel="stylesheet" type="text/css" href="../../view/css/register_company.css">
    <link rel="icon" type="image/x-icon" href="../images/favicon.ico">
    <title>Cadastro de Empresa</title>
</head>

<script type = "text/javascript">
    /* When the user clicks on the button,
    toggle between hiding and showing the dropdown content */
    function myFunction() {
      document.getElementById("myDropdown").classList.toggle("show");
    }
    // Close the dropdown menu if the user clicks outside of it
    window.onclick = function(event) {
      if (!event.target.matches('.dropbtn')) {
        var dropdowns = document.getElementsByClassName("dropdown-content");
        var i;
        for (i = 0; i < dropdowns.length; i++) {
          var openDropdown = dropdowns[i];
          if (openDropdown.classList.contains('show')) {
            openDropdown.classList.remove('show');
          }
        }
      }
    }
  </script>

<script type="module">
    import supabaseAuthentication from "../../control/SupabaseUtils.js"
    import searchJobs from "../../control/searchSupabase.js"

    function getCookie(name) {
      const value = `; ${document.cookie}`;
      const parts = value.split(`; ${name}=`);
      if (parts.length === 2) return parts.pop().split(';').shift();
    }

    if (document.cookie.split(';').some((item) => item.trim().startsWith('session_id=')) && getCookie("session_id").length > 1) {
      const _supabase = supabaseAuthentication();

      async function logout() {
        let old_cookie_value = getCookie("session_id") 
        let user_id = getCookie("user_id")
        window.document.cookie = "session_id=;Path=/"
        window.document.cookie = "user_id=;Path=/"

        let update_info = {
          session_id: ""
        }

        const {data: data_update, error: error_update } = await _supabase
                                  .from('users-auth')
                                  .update(update_info)
                                  .eq("user_id",user_id)
      }

      const userLogout = document.getElementById("logout")
      userLogout.addEventListener("click", e => {
        logout()
        document.location.href = "../pages/logout.html"
      })

      const formInput = document.querySelector("[register-company]");
      document.addEventListener("DOMContentLoaded", function(event){
        formInput.onsubmit = registerAction.bind(formInput)
        })

        const registerAction = async (event) => {
          event.preventDefault()
          
          const company_name = event.target[0].value.toLowerCase()
          const company_cnpj = event.target[1].value.toLowerCase()
          const company_street = event.target[2].value.toLowerCase()
          const company_neighborhood = event.target[3].value.toLowerCase()
          const company_city = event.target[4].value.toLowerCase()
          const company_state = event.target[5].value.toLowerCase()
          const company_phone = event.target[6].value.toLowerCase()
          const company_logo = event.target[7].value.toLowerCase()

          //ADICIONAR A LOGICA DE VERIFICACAO DE CAMPOS NÃO NULOS
          //CRIAR CLASSE PARA REGISTRAR A EMPRESA
          jobsFiltered.then(arrayPosition => {
          arrayPosition.forEach(position => {
                const card = userCardTemplate.content.cloneNode(true).children[0]
                const position_company = card.querySelector("[position-company]")
                const position_name = card.querySelector("[position-name]")
                const detail_button_id = card.querySelector("[detail-button-id]")
                position_company.textContent = position.companyName
                position_name.textContent = position.positionName
                detail_button_id.innerText = position.positionId
                userCardContainer.append(card)
                return { id:position.positionId, name: position.positionName, company: position.companyName, element: card }
              }) 
            })
        }
    }
    else {
      document.location.href = "../pages/needs_login.html"
    }
</script>

<main>
    <div>
        <img class="video_page_logo" src="../images/logo.png">
        <button id="logout" class="button--logout">Deslogar</button>
        <div class="dropdown">
          <button onclick="myFunction()" class="dropbtn">Menu</button>
          <div id="myDropdown" class="dropdown-content">
            <a href="page_user.html" style="background: #E5E5E5;">Buscar Vagas</a>
            <a href="#" style="background: #E5E5E5;">Cadastrar Empresa</a>
            <a href="#" style="background: #E5E5E5;">Cadastrar Vagas</a>
            <a href="videopage_user.html" style="background: #E5E5E5;">Como usar o CataEmprego</a>
            <a href="about_us.html" style="background: #E5E5E5;">Sobre o CataEmprego</a>
          </div>
        </div>
      </div>  
</main>
<body>
   <h1 style="align-items: center; margin-left:35%; background: none; color: white; padding-bottom: 10px;">Cadastro de Empresa</h1> 
   <form id = "register_company" style="margin-left:35%; background: none;" register-company>
       <h5>Digite o nome ou razão social de sua empresa:</h5>
       <input id="company_name" class="user--input" type="text">
       <h5>Digite o CNPJ de sua empresa:</h5>
       <input id="company_cnpj" class="user--input" type="text">
       <h5>Digite a rua de sua empresa:</h5>
       <input id="company_street" class="user--input" type="text">
       <h5>Digite o bairro de sua empresa:</h5>
       <input id="company_neighborhood" class="user--input" type="text">
       <h5>Digite a cidade de sua empresa:</h5>
       <input id="company_city" class="user--input" type="text">
       <h5>Digite o estado de sua empresa:</h5>
       <input id="company_state" class="user--input" type="text">
       <h5>Digite o número de telefone de sua empresa:</h5>
       <input id="company_phone" class="user--input" type="tel">   
       <h5>Adicione o logo de sua empresa:</h5>
       <input id="company_logo" class="user--input" type="file" accept="image/*;.jpeg;.jpg">
       <input class= "button--send" type='submit'>
   </form>  
</body>
</html>